# SAP Replay Reader GUI Application

## Overview

This GUI application provides a user-friendly interface for analyzing and viewing SAP Replay data. It includes three main tabs for different functionalities:

1. **Data Processing Tab** - Execute backend operations to process and organize replay data
2. **Replay Summary Tab** - Browse, filter, and search through replay records
3. **Replay Viewer Tab** - View detailed information about a specific replay with action timeline visualization

## Features

### Data Processing Tab
- **Update Process DB**: Updates the process database with files from the Replays folder
- **Extract Opponent PIDs**: Extracts opponent participation IDs from existing replays
- **Generate Summary DB**: Generates the summary.csv file from all replay files
- **Check for Opponent PIDs**: Checks summary for missing opponent replay data

Each operation includes:
- Progress bar to track completion
- Real-time output console showing operation progress
- Error handling and reporting

### Replay Summary Tab
Displays replay data from `summary.csv` with advanced filtering capabilities:
- **Username Filter**: Search for specific players
- **Opponent Filter**: Find games against specific opponents
- **Outcome Filter**: Filter by Win, Loss, Draw, or Abandoned
- **Game Mode Filter**: Standard, Weekly, or Custom modes
- **Ranked Games Only**: Toggle to show only ranked games
- **Min Turns**: Filter replays with minimum turn count
- **Clear Filters**: Reset all filters at once

Features:
- Scrollable data table with 8 columns
- Replay count indicator
- One-click selection to view replay details
- Automatic tab switching to Replay Viewer

### Replay Viewer Tab
Displays comprehensive information about a selected replay:

**Left Panel - Replay Details:**
- Match ID and Participation ID
- Username and User ID
- Game outcome (Win/Loss/Draw/Abandoned)
- Number of turns
- Game mode
- Creation timestamp
- Game version
- Ranked status
- Player pack information

**Right Panel - Action Timeline:**
- **Interactive Timeline Chart**: Visualizes lives over time
- **X-Axis Mode Toggle**:
  - Turns: Show progression by turn number
  - Timestamp: Show progression by actual time elapsed
- **Action Summary**: Statistics including:
  - Total number of actions
  - Maximum turn reached
  - Final lives count
  - Breakdown of action types (Rolls, Purchases, Combines, etc.)

## Installation

### Prerequisites
- Python 3.7 or higher
- pip package manager

### Setup

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Ensure you have the required replay data:
   - `summary.csv` file in the project root (generated by "Generate Summary DB" operation)
   - `Replays/` folder containing JSON replay files

## Usage

### Launching the GUI

Run the application using:
```bash
python -m sapreplayreader
```

Or explicitly with `--gui`:
```bash
python -m sapreplayreader --gui
```

### Workflow

#### First Time Setup
1. Open the **Data Processing** tab
2. Click **"Update Process DB"** to scan existing replays
3. Click **"Generate Summary DB"** to create the summary data file
4. Wait for operations to complete (check the output console and progress bar)

#### Browsing Replays
1. Navigate to the **Replay Summary** tab
2. Use filters to find replays of interest
3. Click on a row to select a replay
4. Click **"View Selected Replay"** to switch to the Replay Viewer

#### Analyzing a Replay
1. The **Replay Viewer** tab will automatically display when you select a replay
2. View detailed game information in the left panel
3. Analyze the action timeline in the right panel
4. Toggle between "Turns" and "Timestamp" X-axis modes for different perspectives

#### Processing New Replays
1. Add new replay JSON files to the `Replays/` folder
2. Go to **Data Processing** tab
3. Click **"Update Process DB"** to register new replays
4. Click **"Generate Summary DB"** to regenerate the summary with new data

## Application Layout

### Main Window
- **Top-Right Corner**: Red "Close Application" button (always visible, unaffected by tab changes)
- **Tab Widget**: Three tabs for main functionality
- **Tab Bar**: Navigation between Data Processing, Replay Summary, and Replay Viewer

### Data Processing Tab
```
┌─────────────────────────────────────┐
│ Processing Operations:  │ Progress Bar     │
│ ┌─────────────────────┐ │ ┌──────────────┐ │
│ │ Update Process DB   │ │ │ Processing   │ │
│ │ Extract Opponent... │ │ │ Output:      │ │
│ │ Generate Summary DB │ │ │              │ │
│ │ Check for Opp PIDs  │ │ │              │ │
│ └─────────────────────┘ │ │              │ │
│ Clear Filters           │ │              │ │
│ Replays: [count]        │ └──────────────┘ │
│                         │ Progress: [##]   │
└─────────────────────────────────────┘
```

### Replay Summary Tab
```
┌──────────────────────────────────────┐
│ Filters:     │ Summary Data Table:   │
│ Username:    │ ┌──────────────────┐ │
│ Opponent:    │ │User│Opp│Out│Turn│ │
│ Outcome:     │ ├──────────────────┤ │
│ Game Mode:   │ │    │   │   │    │ │
│ Ranked:      │ └──────────────────┘ │
│ Min Turns:   │ Replays: [count]      │
│ [Clear]      │ [View Selected Replay]│
└──────────────────────────────────────┘
```

### Replay Viewer Tab
```
┌─────────────────────────────────────┐
│ Replay Details:  │ Action Timeline:  │
│ ┌──────────────┐ │ ┌──────────────┐ │
│ │Match ID:     │ │ │Lives by Turn │ │
│ │Username:     │ │ │ X-Axis: [Turn]│
│ │Outcome:      │ │ └──────────────┘ │
│ │Turns:        │ │ Action Summary:  │
│ │...           │ │ Total: ###       │
│ │...           │ │ Breakdown: ...   │
│ └──────────────┘ │ ...              │
└─────────────────────────────────────┘
```

## Keyboard Shortcuts

- **Tab Navigation**: Use Ctrl+Tab or Ctrl+Shift+Tab to switch between tabs
- **Alt+F4**: Close the application

## Styling

The application uses a modern light theme with:
- Blue accent colors for primary actions
- Green for view/select operations
- Red for destructive operations (close button)
- Light gray backgrounds
- Clear visual hierarchy

## Extensibility

The codebase is designed to be easily extended:

- **ReplayTimelineVisualization**: Can be augmented with additional visualization types
- **ReplayViewerTab**: Add more fact displays or analysis panels
- **DataProcessingTab**: Add more processing operations
- **ReplaySummaryTab**: Add more filter options

For adding new visualizations or analysis features to the timeline, see the `ReplayTimelineVisualization` class in `gui_replay_viewer.py`.

## Troubleshooting

### "summary.csv not found" error
- Run "Generate Summary DB" from the Data Processing tab first

### No replay data showing up
- Ensure replay JSON files are in the `Replays/` folder
- Run "Update Process DB" to scan for new files
- Run "Generate Summary DB" to regenerate summary

### Performance Issues with Large Datasets
- Filter the summary before viewing individual replays
- Consider limiting the number of replays processed at once

### PyQt6 Import Errors
- Install PyQt6: `pip install PyQt6>=6.0.0`
- Ensure other dependencies are installed: `pip install -r requirements.txt`

## File Structure

```
src/sapreplayreader/
├── gui_main.py              # Main window and tab management
├── gui_data_processing.py   # Data processing tab implementation
├── gui_replay_summary.py    # Replay summary tab implementation
├── gui_replay_viewer.py     # Replay viewer tab implementation
├── reader.py                # Backend replay data processing
└── api_calls.py             # API interactions (if needed)
```

## Dependencies

- **PyQt6** (>=6.0.0): GUI framework
- **pandas** (>=1.3.5): Data handling
- **requests** (>=2.28): HTTP requests
- **python-dotenv** (>=0.21.0): Environment variable management

## Notes

- The application auto-saves progress updates during processing operations
- Replays are identified by their Participation ID (PID)
- All timestamps are in UTC
- The timeline visualization is optimized for replays with up to 50+ turns
